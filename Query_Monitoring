SELECT 
    -- User Core Info
    u.user_id,
    u.email,
    u.account_status,
    
    -- KYC Details
    kyc.verification_status AS kyc_status,
    kyc.risk_level AS individual_risk,
    
    -- KYB Details
    kyb.business_name,
    kyb.tax_id,
    kyb.verification_status AS kyb_status,
    
    -- Monitoring Flags
    CASE 
        WHEN kyc.verification_status = 'Passed' AND kyb.verification_status = 'Passed' THEN 'Fully Compliant'
        WHEN kyc.verification_status = 'Pending' OR kyb.verification_status = 'Pending' THEN 'Under Review'
        ELSE 'Action Required'
    END AS compliance_health_score

FROM Platform_Core.user_accounts u
-- Joining KYC data
LEFT JOIN Identity_Vault.verification_status kyc 
    ON u.user_id = kyc.user_id
-- Joining KYB data via the Beneficial Owners mapping
LEFT JOIN Corporate_Registry.beneficial_owners bo 
    ON u.user_id = bo.owner_id
LEFT JOIN Corporate_Registry.business_profiles kyb 
    ON bo.business_id = kyb.business_id

ORDER BY u.created_at DESC;
